<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mon Espace DIGIY</title>

<style>
:root{
  --bg:#022c22;--bg2:#065f46;--card:#052e16;
  --accent:#facc15;--text:#e5e7eb;--muted:#9ca3af;
  --danger:#f97373;--ok:#22c55e;
  --line:rgba(148,163,184,.28);
  --glass:rgba(2,44,34,.35);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  min-height:100vh;
  display:flex;align-items:center;justify-content:center;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:linear-gradient(135deg,var(--bg),var(--bg2));
  color:var(--text);padding:20px;
}
.card{
  max-width:640px;width:100%;
  background:linear-gradient(145deg,rgba(5,46,22,.97),rgba(6,95,70,.96));
  border-radius:26px;border:1px solid rgba(15,118,110,.45);
  padding:22px;box-shadow:0 24px 60px rgba(0,0,0,.7);
}
.top{display:flex;justify-content:space-between;align-items:center}
.ico{
  width:52px;height:52px;border-radius:50%;
  display:grid;place-items:center;
  background:radial-gradient(circle at 30% 0,#facc15,transparent 55%);
  color:#022c22;font-size:24px;font-weight:900;
}
h1{font-size:14px;letter-spacing:.14em}
.subtitle{font-size:12px;color:var(--muted)}
.pill{
  border:1px solid var(--line);
  background:rgba(250,204,21,.12);
  padding:8px 12px;border-radius:999px;
  font-weight:900;font-size:12px;cursor:pointer;
}
.sep{height:1px;background:var(--line);margin:14px 0}
#status{font-size:14px;color:var(--muted)}
#mini{font-size:12px;color:var(--muted);margin-top:6px}
.ok{color:var(--ok)} .err{color:var(--danger)}
.grid{display:grid;gap:10px;margin-top:14px}
.btn{
  width:100%;padding:14px;
  background:var(--glass);border:1px solid var(--line);
  border-radius:16px;color:var(--text);
  display:flex;justify-content:space-between;align-items:center;
  cursor:pointer;font-weight:900;
}
.btn:hover{border-color:rgba(250,204,21,.6)}
.tag{
  padding:6px 10px;border-radius:999px;
  background:rgba(250,204,21,.12);
  border:1px solid rgba(250,204,21,.35);
  font-size:12px;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
<div class="card">
  <div class="top">
    <div>
      <div class="ico">ðŸ¦…</div>
      <h1>MON ESPACE DIGIY</h1>
      <div class="subtitle" id="subtitle">Espace ROI</div>
    </div>
    <div class="pill" id="logout">DÃ©connexion</div>
  </div>

  <div class="sep"></div>

  <div id="status">Chargementâ€¦</div>
  <div id="mini"></div>

  <div class="grid" id="modules"></div>
</div>

<script>
(async()=>{
const SUPABASE_URL="https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

const LOGIN_URL="https://beauville.github.io/login-otp-fix/";
const MODULES_URL={
  chauffeur:"https://beauville.github.io/digiy-chauffeur/",
  loc:"https://beauville.github.io/digiy-loc-pro-/",
  resto:"https://beauville.github.io/digiy-resto-pro/",
  market:"https://beauville.github.io/digiy-market-pro/"
};

const client=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);
const status=document.getElementById("status");
const mini=document.getElementById("mini");
const grid=document.getElementById("modules");

const {data:s}=await client.auth.getSession();
if(!s?.session){location.href=LOGIN_URL;return;}

const {data:u}=await client.auth.getUser();
const user=u.user;

const {data:pro}=await client
  .from("pros")
  .select("modules,is_active,display_name,auth_user_id")
  .eq("auth_user_id",user.id)
  .maybeSingle();

if(!pro||!pro.is_active){
  status.innerHTML="<span class='err'>Compte non actif</span>";
  return;
}

// ðŸ”¥ PRIVILÃˆGE ROI : TOI TU VOIS TOUT
const modules=[...new Set(pro.modules||[])];

status.innerHTML="<span class='ok'>AccÃ¨s total validÃ©</span>";
mini.innerHTML="Choisis ton module ðŸ‘‘";

modules.forEach(m=>{
  const btn=document.createElement("div");
  btn.className="btn";
  btn.innerHTML=`<div>${m.toUpperCase()}</div><span class="tag">ouvrir</span>`;
  btn.onclick=()=>location.href=MODULES_URL[m];
  grid.appendChild(btn);
});

document.getElementById("logout").onclick=async()=>{
  await client.auth.signOut();
  location.href=LOGIN_URL;
};
})();
</script>
</body>
</html>
